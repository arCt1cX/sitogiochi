// Language utility for DrewGames
const translations = {
    'it': {
        // Meta data
        'pageTitle': 'DrewGames - Giochi da fare con gli amici offline',
        'pageDescription': 'DrewGames: una collezione di giochi divertenti da fare con gli amici offline. Scopri giochi interattivi come Impostor, ColorGrid, GuessThePic e molti altri!',
        
        // Common elements across all pages
        'home': 'Home',
        'play': 'Gioca',
        'comingSoon': 'Coming Soon',
        'newGamesComingSoon': 'Nuovi giochi in arrivo...',
        'copyright': 'Â© 2025 partygamesdrew.com - Tutti i diritti riservati',
        'toggleLanguage': 'IT',
        'tagline': 'Illumina la mente, scatena la serata',
        'subtitle': 'Giochi da fare con gli amici offline ðŸŽ‰',
        'buyMeCoffee': 'Buy me a coffee',
        'italianOnly': 'Solo Italiano',
        
        // Navigation Items
        'navHome': 'Home',
        'navGames': 'Giochi',
        'navAbout': 'Chi Siamo',
        'navLegalHeader': 'Legale',
        'navPrivacy': 'Privacy Policy',
        'navTerms': 'Termini di Servizio',
        'navCookies': 'Cookie Policy',
        
        // Games Catalog Page
        'gamesPageTitle': 'La Collezione Completa dei Giochi',
        'gamesIntro': 'Benvenuti nella nostra collezione completa di giochi! Qui puoi esplorare ogni gioco nel dettaglio, imparare come si gioca e scoprire suggerimenti per rendere l\'esperienza ancora piÃ¹ divertente. Tutti i nostri giochi sono progettati per essere giocati con amici offline, senza bisogno di internet dopo il caricamento iniziale.',
        'tocTitle': 'Indice dei Giochi',
        'playNow': 'Gioca Ora',
        'features': 'Caratteristiche',
        'howToPlay': 'Come Giocare',
        'playersNeeded': 'Giocatori Necessari',
        'duration': 'Durata',
        'difficulty': 'DifficoltÃ ',
        'beginner': 'Principiante',
        'intermediate': 'Intermedio',
        'advanced': 'Avanzato',
        'minutes': 'minuti',
        'players': 'giocatori',
        
        // Game titles and descriptions
        'impostor': {
            'title': 'Impostor',
            'catchphrase': 'Scopri chi mente nel gruppo!',
            'description': 'Impostor Ã¨ un gioco di deduzione sociale dove un giocatore Ã¨ l\'impostore che non conosce l\'argomento. Gli altri giocatori devono scoprire chi Ã¨ l\'impostore, mentre l\'impostore cerca di mimetizzarsi e identificare l\'argomento segreto.',
            'players': '4-10 giocatori',
            'time': '10-15 minuti',
            'difficulty': 'Principiante',
            'features': [
                'ModalitÃ  di gioco casuale e personalizzata',
                'Centinaia di argomenti predefiniti',
                'Timer integrato per le discussioni',
                'Interfaccia semplice e intuitiva'
            ],
            'instructions': [
                'Un giocatore sarÃ  scelto casualmente come impostore',
                'A tutti gli altri giocatori viene mostrato un argomento segreto',
                'A turno, ogni giocatore deve dire una parola relativa all\'argomento',
                'Dopo alcuni turni, tutti votano per chi pensano sia l\'impostore',
                'L\'impostore vince se non viene individuato o se indovina l\'argomento'
            ]
        },
        'colorgrid': {
            'title': 'Color Grid',
            'catchphrase': 'Indovina la cella colorata segreta!',
            'description': 'In Color Grid, i giocatori devono indovinare la posizione di una cella colorata nascosta in una griglia. Ad ogni tentativo, riceveranno un indizio sulla distanza dalla cella segreta. Un gioco di logica e deduzione perfetto per sfidare gli amici!',
            'players': '2-8 giocatori',
            'time': '5-10 minuti',
            'difficulty': 'Principiante',
            'features': [
                'Griglie di diverse dimensioni (da 5x5 a 10x10)',
                'ModalitÃ  competitiva e cooperativa',
                'Sistema di punteggi basato sui tentativi',
                'Design colorato e accattivante'
            ],
            'instructions': [
                'Scegli la dimensione della griglia',
                'Una cella colorata viene nascosta casualmente',
                'I giocatori fanno a turno per indovinare',
                'Dopo ogni tentativo, viene mostrato quanto sei vicino',
                'Vince chi trova la cella con meno tentativi'
            ]
        },
        'guessthepic': {
            'title': 'Guess Rush',
            'catchphrase': 'Indovina cosa mostrano le 5 immagini e accumula piÃ¹ punti!'
        },
        'timergame': {
            'title': 'Wordrace',
            'catchphrase': 'Corri contro il tempo in questa sfida di parole!'
        },
        'chainreaction': {
            'title': 'Chain Reaction',
            'catchphrase': 'Crea concatenazioni di parole in questa sfida a squadre!'
        },
        'alphabetgame': {
            'title': 'Alphabet Game',
            'catchphrase': 'Trova parole che iniziano con una lettera specifica!'
        },
        'bluffme': {
            'title': 'BluffMe',
            'catchphrase': 'Riuscirai a bluffare i tuoi amici e vincere la partita?'
        },
        'quizzy': {
            'title': 'Quizzy',
            'catchphrase': 'Sfida i tuoi amici in un divertente gioco a quiz!'
        },
        'tictactopics': {
            'title': 'TicTacTopics',
            'catchphrase': 'Tris con argomenti tematici, film, serie TV e molto altro!'
        }
    },
    'en': {
        // Meta data
        'pageTitle': 'DrewGames - Games to play with friends offline',
        'pageDescription': 'DrewGames: a collection of fun games to play with friends offline. Discover interactive games like Impostor, ColorGrid, GuessThePic and many more!',
        
        // Common elements across all pages
        'home': 'Home',
        'play': 'Play',
        'comingSoon': 'Coming Soon',
        'newGamesComingSoon': 'New games coming soon...',
        'copyright': 'Â© 2025 partygamesdrew.com - All rights reserved',
        'toggleLanguage': 'EN',
        'tagline': 'Enlighten minds, ignite the night',
        'subtitle': 'Games to play with friends offline ðŸŽ‰',
        'buyMeCoffee': 'Buy me a coffee',
        'italianOnly': 'Italian Only',
        
        // Navigation Items
        'navHome': 'Home',
        'navGames': 'Games',
        'navAbout': 'About Us',
        'navLegalHeader': 'Legal',
        'navPrivacy': 'Privacy Policy',
        'navTerms': 'Terms of Service',
        'navCookies': 'Cookie Policy',
        
        // Games Catalog Page
        'gamesPageTitle': 'The Complete Collection of Games',
        'gamesIntro': 'Welcome to our complete collection of games! Here you can explore each game in detail, learn how to play, and discover tips to make the experience even more fun. All our games are designed to be played with friends offline, with no need for internet after the initial loading.',
        'tocTitle': 'Games Index',
        'playNow': 'Play Now',
        'features': 'Features',
        'howToPlay': 'How to Play',
        'playersNeeded': 'Players Needed',
        'duration': 'Duration',
        'difficulty': 'Difficulty',
        'beginner': 'Beginner',
        'intermediate': 'Intermediate',
        'advanced': 'Advanced',
        'minutes': 'minutes',
        'players': 'players',
        
        // Game titles and descriptions
        'impostor': {
            'title': 'Impostor',
            'catchphrase': 'Find out who is lying in the group!',
            'description': 'Impostor is a social deduction game where one player is the impostor who doesn\'t know the topic. The other players must figure out who the impostor is, while the impostor tries to blend in and identify the secret topic.',
            'players': '4-10 players',
            'time': '10-15 minutes',
            'difficulty': 'Beginner',
            'features': [
                'Random and custom game modes',
                'Hundreds of predefined topics',
                'Built-in timer for discussions',
                'Simple and intuitive interface'
            ],
            'instructions': [
                'One player will be randomly chosen as the impostor',
                'All other players are shown a secret topic',
                'Taking turns, each player must say a word related to the topic',
                'After several rounds, everyone votes for who they think is the impostor',
                'The impostor wins if they remain undetected or guess the topic'
            ]
        },
        'colorgrid': {
            'title': 'Color Grid',
            'catchphrase': 'Guess the secret colored cell!',
            'description': 'In Color Grid, players must guess the position of a hidden colored cell in a grid. With each attempt, they will receive a clue about the distance from the secret cell. A game of logic and deduction perfect for challenging friends!',
            'players': '2-8 players',
            'time': '5-10 minutes',
            'difficulty': 'Beginner',
            'features': [
                'Grids of different sizes (from 5x5 to 10x10)',
                'Competitive and cooperative modes',
                'Scoring system based on attempts',
                'Colorful and engaging design'
            ],
            'instructions': [
                'Choose the grid size',
                'A colored cell is randomly hidden',
                'Players take turns guessing',
                'After each attempt, you\'re shown how close you are',
                'The player who finds the cell with fewer attempts wins'
            ]
        },
        'guessthepic': {
            'title': 'Guess Rush',
            'catchphrase': 'Guess what the 5 images show and score points!'
        },
        'timergame': {
            'title': 'Wordrace',
            'catchphrase': 'Race against time in this word challenge!'
        },
        'chainreaction': {
            'title': 'Chain Reaction',
            'catchphrase': 'Create word chains in this team challenge!'
        },
        'alphabetgame': {
            'title': 'Alphabet Game',
            'catchphrase': 'Find words that start with a specific letter!'
        },
        'bluffme': {
            'title': 'BluffMe',
            'catchphrase': 'Can you bluff your friends and win the game?'
        },
        'quizzy': {
            'title': 'Quizzy',
            'catchphrase': 'Challenge your friends in a fun quiz game!'
        },
        'tictactopics': {
            'title': 'TicTacTopics',
            'catchphrase': 'Tic-Tac-Toe with thematic topics, movies, TV shows and more!'
        }
    }
};

// Flag SVGs for language toggle
const flagSVGs = {
    'it': `
        <!-- Italian flag -->
        <rect width="640" height="480" fill="#ffffff"/>
        <rect width="213.3" height="480" fill="#009246"/>
        <rect width="213.3" height="480" x="426.7" fill="#ce2b37"/>
    `,
    'en': `
        <!-- UK flag (Union Jack) - Improved version -->
        <rect width="640" height="480" fill="#012169"/>
        <path d="M0,0 L640,480 M640,0 L0,480" stroke="#ffffff" stroke-width="96"/>
        <path d="M0,0 L640,480 M640,0 L0,480" stroke="#c8102e" stroke-width="64"/>
        <rect width="640" height="96" y="192" fill="#ffffff"/>
        <rect width="96" height="480" x="272" fill="#ffffff"/>
        <rect width="640" height="48" y="216" fill="#c8102e"/>
        <rect width="48" height="480" x="296" fill="#c8102e"/>
    `
};

// Function to get user's language preference
function getUserLanguage() {
    // Check if language is specified in URL
    const urlParams = new URLSearchParams(window.location.search);
    const urlLang = urlParams.get('lang');
    if (urlLang === 'en' || urlLang === 'it') {
        // Store the URL language preference in localStorage
        localStorage.setItem('lang', urlLang);
        return urlLang;
    }
    
    // Check if a language is stored in localStorage
    const storedLang = localStorage.getItem('lang');
    if (storedLang) {
        return storedLang;
    }
    
    // If no stored preference, try to detect based on browser language
    const browserLang = (navigator.language || navigator.userLanguage || '').toLowerCase();
    console.log('Detected browser language:', browserLang);
    
    // More specific check for Italian language
    if (browserLang === 'it' || browserLang === 'it-it' || browserLang.startsWith('it-')) {
        localStorage.setItem('lang', 'it');
        return 'it';
    } else {
        // Default to English for any other language
        localStorage.setItem('lang', 'en');
        return 'en';
    }
}

// Function to set the user's language preference
function setUserLanguage(lang) {
    if (lang !== 'en' && lang !== 'it') {
        lang = 'en'; // Default to English for invalid values
    }
    localStorage.setItem('lang', lang);
    return lang;
}

// Function to toggle between languages
function toggleLanguage() {
    const currentLang = getUserLanguage();
    const newLang = currentLang === 'it' ? 'en' : 'it';
    setUserLanguage(newLang);
    
    // Update URL if needed
    const url = new URL(window.location.href);
    url.searchParams.set('lang', newLang);
    window.location.href = url.toString();
}

// Function to get a translation
function getTranslation(key, subKey = null) {
    const lang = getUserLanguage();
    
    if (subKey) {
        // For nested translations like game titles/descriptions
        if (translations[lang][key] && translations[lang][key][subKey]) {
            return translations[lang][key][subKey];
        }
        // Fallback to English if translation not found
        return translations['en'][key][subKey];
    } else {
        // For top-level translations
        if (translations[lang][key]) {
            return translations[lang][key];
        }
        // Fallback to English if translation not found
        return translations['en'][key];
    }
}

// Function to check if we're on the main page
function isMainPage() {
    // If we're at the root or index.html, it's the main page
    const path = window.location.pathname;
    return path === '/' || path.endsWith('/index.html') || path === '/sitogiochi/' || path.endsWith('/sitogiochi/index.html');
}

// Function to set the flag icon based on current language
function setFlagIcon() {
    const currentFlag = document.getElementById('currentFlag');
    if (currentFlag) {
        const lang = getUserLanguage();
        currentFlag.innerHTML = flagSVGs[lang];
        
        // Set aria-label for accessibility
        const languageToggle = document.getElementById('languageToggle');
        if (languageToggle) {
            const nextLang = lang === 'it' ? 'en' : 'it';
            languageToggle.setAttribute('aria-label', `Switch to ${nextLang === 'en' ? 'English' : 'Italian'}`);
        }
    }
}

// Apply translations to the current page
function applyTranslations() {
    // Debug language detection
    console.log('Language detection debug:');
    console.log('- URL parameter:', new URLSearchParams(window.location.search).get('lang'));
    console.log('- localStorage lang:', localStorage.getItem('lang'));
    console.log('- navigator.language:', navigator.language);
    console.log('- navigator.userLanguage:', navigator.userLanguage);
    console.log('- document.documentElement.lang:', document.documentElement.lang);
    console.log('- Selected language:', getUserLanguage());
    
    const lang = getUserLanguage();
    document.documentElement.lang = lang;
    
    // Update meta tags if they exist
    const pageTitle = document.getElementById('pageTitle');
    if (pageTitle) {
        document.title = getTranslation('pageTitle');
    }
    
    const pageDescription = document.getElementById('pageDescription');
    if (pageDescription) {
        pageDescription.setAttribute('content', getTranslation('pageDescription'));
    }
    
    // Handle language toggle - only show on main page
    const languageToggle = document.getElementById('languageToggle');
    if (languageToggle) {
        if (isMainPage()) {
            languageToggle.style.display = 'flex';
            setFlagIcon();
        } else {
            languageToggle.style.display = 'none';
        }
    }
} 